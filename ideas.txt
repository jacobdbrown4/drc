

Tests to make:
    organ insertion
    uniquify nmr property - Done - add isinstance(...,str) to only get string values? and not integers?
    load primitive info
    find all leaf cells
    feed back folding
    pin clock domain analysis

Documentation:
    pin_clock_domain_analysis
        finds the different clock domains?
        will print a report
        will return a list of dictionaries. Each is an inner pin and its <<<Something>>> inner pins

    feedback folding
    find voter insertion points pin level????

COMPLEX
    add_modified. output ports not triplicated.
    add0 through add3 voters are named COMPLEX and output to 4 output LED's. It is its own cable.
    Then the other add instances have voters that output to the other 4 output bufs. Its own cable again.
    In original, it's all together. Not sure why it got split up.


Design Rule Check:
    Fully replicated:
        No organs: check_by_step, check_by_pin_connections, check_by_instance_properties, check_by_instance_connections
        Organs: check_by_step, check_by_pin_connections, check_by_instance_properties, check_by_instance_connections
        Complex: check_by_step, check_by_pin_connections, check_by_instance_properties, check_by_instance_connections

    Output not replicated:
        No organs: check_by_instance_properties
        Organs: check_by_step, check_by_pin_connections, check_by_instance_properties, check_by_instance_connections
        Complex: check_by_step, check_by_pin_connections, check_by_instance_properties, check_by_instance_connections

Functions:
    check_by_pin_connections
        - DOES: makes sure what was connected is still connected by checking each instance's pins
        - doesn't work for only tmr with not output ports
        - works for full tmr with and without organs
        - works for partial tmr with organs
    check_by_step
        - DOES: steps through a design.
        - doesn't work for only tmr with not output ports
        - works for full tmr with and without organs
        - works for partial tmr with organs
    check_by_instance_properties
        - DOES: compare's each instance's EDIF.properties with the corresponding original instance
        - works for all
    , check_by_instance_connections
        - DOES: checks what each instance connects to (whether leaf or non leaf)
        - doesn't work for only tmr with not output ports
        - works for full tmr with and without organs
        - works for partial tmr with organs


Note: sometimes it won't insert voters if there are buffers/if buffers are replicated. So get rid of buffers in the list and it will insert voters.
    That's how I fixed 4bitadder and one_counter


ignore VCC in check by pin connections?


find_voter_insertion_points
    Line 77 in find_voter_insertion_points . Get rid of pin.wire and see what happens.
        maybe it'll insert voters into non replicated, disconnected ports.
        Lines 79-83 too. It checks if there is a wire.

    Line 94 -97. see what it does. Does it find the next leaf that it drives?
            wires = sub_pin.get_hwires(selection="ALL")
            pins = set(sdn.get_hpins(wires, filter=lambda x: x.item.port.definition.is_leaf() and x.item.port.direction is sdn.IN))
            instances = set(sdn.get_hinstances(pins))

    Line 102 - can't there be multiple outter pins for that one sub_pin? Or is it dif cause it's an href?
        It looks like it might just get the first one?


try instance.get_pins(outside) vs instance.get_hpins(inside or outside)


Went over with Andrew:
    - can use find_voter_insertion points for detectors, but it may not be best. He suggested doing insertion without including feedback. only reduction would be good. You don't need so many detectors throughout it, especially in feedback.
    - surface_pins : can bring detector output pins up. Helpful with just detectors??
    - Find a project to work on the side using these tools. TMR it. Does it work? Insert detectors. Does it work? etc.
    - try some stuff out using the tools. Mess with it.


Where I left off/to do:
    SpyDrNet:
        Talk about a DRC for SpyDrNet. What could we do?
        work on getter cheat sheet
        Test to check netlists?? For case sensitive stuff
        Clean up spydrnet front page. Now Verilog is supported. Also is vo and vqm??
    Documentation:
        Organs documentation
        Voter algorithms page. Get Ben's document?
        Run pylint for every release. Document our score.
        Get Andy's script that works for his design. Add it as another example. Get the netlist too. We need to document this.
        add references to other pages in the documentation e.g. used in find_voter_insertion_points() (make it a link)
        add stopwatch_no_buf tmr as an example? include constraints and everything for the basys 3 board
        add example of doing stopwatch with TMR and DWC together? Like we tmr it like normal and put detectors in as well?
    Testing:
        we have lots of testing using drc for edif netlists but not verilog. work on that.
    Functions:
        Find high fan out flip flops and put a voter on their input. Cause they're important so we want them to be right.
        shouldn't reduction voters be placed wherever we're going from replicated to non-replicated even if it's not a flip flop? 
            write a function to find and fix this. Take replicas, find what got left out, check if there are reduction voters, if not, add a spot.  
        get total leaf instance count. Then order from highest to low of how many other leafs each outputs to. Then get top 10% or so and give them voters.
            or just flip flops os we can cut feedback.
    DRC:   
        try drc out with before_ff now that it's fixed. It don't work. Still broke on b13
        add an example showing how to use the drc. It's simple but will be good. Maybe show a passed test and a failed test.
        compare properties takes too long. optimize by making each non_leaf a dictionary full of his leaf children, just like in the other one.
            see if the above is enough and we don't have to make strings out of everything.
    Other:
        Test Travis with the DRC patch release
        should travis only run when merging with master?
        When to do a patch release?
        look into submodules
        make insert organs so it can insert a voter at the in port.


    Use pin clock domain analysis? It seems to do it. For each of the ports returned, add the drivers.
        or instead of trying to do pin clock domain analysis or this other stuff you have, for each instance's next instances, add that instance as their driver. Then if they don't have a driver, check.??
            But what if they have two drivers? Messed up.
        ***Or if next instance port driven is in [clk,rst,etc.], add it as the driver. Otherwise nah. TRY IT. it won't rely on clock analysis function thing
        I guess if we run clock analysis on both netlists it should come out to equal. Like if one has extra info, so does the other.

    DRC works for find_voter_insertion_points and find_voter_insertion_points_after_ff, but not before ff. Look into that
        uncomment the one line for recursion errors? fixed it?
        does before_ff mess up some connections?
        debuggin before_ff, tell Ben to add selection.OUTSIDE to get_current_pin

    Another Bug? No, but a messed up netlist:

        In float_demo example netlist, fully replicated with voters, i_synth_TMR_#_m_axis_result_tdata[63:0]_VOTER[62] and [63] drive the same wire.
        there is another wire there, but he's not connected. Somehow the connections got messed up.
        Not a compose issue, because i looked at it before composing and saw the same issue.
        weird line in original edif file looks like this:

                (net (rename m_axis_result_tdata_0_ "m_axis_result_tdata[0]") (joined
                (portref (member m_axis_result_tdata 63) (instanceref i_synth))
                (portref (member m_axis_result_tdata 63))
                )
                )
                (net (rename m_aXIS_result_tdata_0_ "m_axis_result_tdata[0]") (joined))

        So that could was messing it up ('aXIS'). After removing that line, it's all fixed. Parsing and connections and voters.
